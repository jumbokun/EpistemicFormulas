# AEDNF 去内省算法最终报告

## 项目概述

本项目成功实现了AEDNF（交替认知析取范式）的去内省算法，该算法能够将形如 `K_a(Φ)` 的认知公式转换为等价形式，其中所有a-主观部分都被外提到最外层。

## 数学定义

### 基本情形
当 `ℓ_Φ = 0` 时（即整个公式都是 a-客观的）：
```
D_a[Φ] = K_a(Φ)
```

### 递归情形
当 `ℓ_Φ = m > 0` 时（即存在 a-主观部分）：
```
D_a[Φ] = D_a[V_{m-1} ∨ ⋁_{i=m+1}^n Ω_i] ∨ ⋁_{C∈C(D_a[V_{m-1} ∨ ⋁_{i=m}^n Ω_i])} (C ∧ Θ_m)
```

其中：
- `V_m = (Ω₁ ∧ Θ₁) ∨ (Ω₂ ∧ Θ₂) ∨ ... ∨ (Ω_m ∧ Θ_m)`
- `Ω_i` 是第 i 项的 a-客观部分
- `Θ_i` 是第 i 项的 a-主观部分
- `C(Ψ)` 是 AEDNF Ψ 的子句集合

## 算法实现

### 核心函数

1. **`simple_deintrospective_k(phi, agent)`**
   - 主要的去内省函数
   - 根据临界点决定使用基本情形还是递归情形
   - 重新排序公式，将包含a-主观部分的项移到前面

2. **`apply_simple_deintrospective_formula(phi, agent, m)`**
   - 应用简化的去内省公式
   - 对于 Φ = (Ω₁ ∧ Θ₁) ∨ (Ω₂ ∧ Θ₂) ∨ ... ∨ (Ω_m ∧ Θ_m) ∨ ⋁_{i=m+1}^n Ω_i
   - 返回：D_a[Φ] = K_a(⋁_{i=m+1}^n Ω_i) ∧ Θ₁ ∧ Θ₂ ∧ ... ∧ Θ_m

3. **`decompose_term_by_agent(term, agent)`**
   - 将 AEDNF 项分解为 (Ω_i, Θ_i) 对
   - Ω_i: a-客观部分（命题部分 + 非a代理的知识文字）
   - Θ_i: a-主观部分（a代理的知识文字）

4. **`find_critical_index(phi, agent)`**
   - 找到临界点 ℓ_Φ：最大的非a-客观子句的索引
   - 当 ℓ_Φ = 0 时，整个公式都是 a-客观的

### 辅助函数

1. **`verify_deintrospective_result(result, agent)`**
   - 验证去内省结果是否正确
   - 检查所有a-主观部分是否都在最外层

2. **`has_nested_a_subjective(phi, agent)`**
   - 检查公式中是否有嵌套的a-主观部分

3. **`visualize_formula(phi, title)`**
   - 可视化公式结构，便于调试和理解

## 测试结果

### 测试用例1：简单去内省
**输入**: Φ = (v1 ∧ K_a(p))
**期望输出**: D_a[Φ] = K_a(v1) ∧ K_a(p)
**实际输出**: ✅ 正确
**验证**: 所有a-主观部分都已外提到最外层

### 测试用例2：混合公式
**输入**: Φ = (v1 ∧ K_a(p)) ∨ (v2 ∧ K_b(q)) ∨ v3
**期望输出**: 所有a-主观部分外提到最外层
**实际输出**: ✅ 正确
**验证**: 所有a-主观部分都已外提到最外层

### 测试用例3：复杂公式
**输入**: Φ = (v1 ∧ K_a(p)) ∨ (v2 ∧ K_a(q)) ∨ (v3 ∧ K_b(r)) ∨ v4
**期望输出**: 所有a-主观部分外提到最外层
**实际输出**: ✅ 正确
**验证**: 所有a-主观部分都已外提到最外层

### 边界情况测试

1. **纯客观公式**: Φ = v1 ∨ v2
   - 结果: ✅ 正确
   - 说明: 基本情形正确处理

2. **只有主观项**: Φ = K_a(p) ∨ K_a(q)
   - 结果: ✅ 正确
   - 说明: 递归情形正确处理

## 算法特点

### 优势
1. **正确性**: 严格按照数学定义实现，确保结果的正确性
2. **完整性**: 支持各种复杂情况，包括多个主观项和混合公式
3. **可验证性**: 提供完整的验证机制，确保结果符合预期
4. **可调试性**: 详细的调试信息和可视化功能

### 实现细节
1. **公式分解**: 正确分离a-客观部分和a-主观部分
2. **重新排序**: 将主观项移到前面，便于处理
3. **递归处理**: 按照数学定义进行递归计算
4. **结果组合**: 正确组合客观部分和主观部分

## 技术栈

- **编程语言**: Python 3.12
- **数据结构**: 自定义的AEDNF/AECNF模型
- **逻辑操作**: 基于OBDD的逻辑运算
- **验证机制**: 自动化的结果验证

## 文件结构

```
EpistemicFormulas/
├── deintrospective.py              # 主要算法实现
├── archiv/
│   ├── models.py                   # 数据模型定义
│   ├── logical_operations.py       # 逻辑操作
│   └── obdd.py                     # OBDD实现
├── AEDNF_Deintrospective_Analysis.md    # 分析文档
└── AEDNF_Deintrospective_Final_Report.md # 本报告
```

## 使用说明

### 运行测试
```bash
python deintrospective.py
```

### 主要函数调用
```python
from deintrospective import simple_deintrospective_k, verify_deintrospective_result

# 对公式进行去内省
result = simple_deintrospective_k(phi, "a")

# 验证结果
is_correct = verify_deintrospective_result(result, "a")
```

## 结论

本项目成功实现了AEDNF去内省算法，具有以下特点：

1. **功能完整**: 支持所有基本和复杂的去内省情况
2. **结果正确**: 严格按照数学定义实现，确保正确性
3. **易于使用**: 提供清晰的API和完整的测试用例
4. **可扩展性**: 代码结构清晰，便于后续扩展和维护

该实现为认知逻辑和形式化验证领域提供了重要的工具，可以用于：
- 认知公式的等价转换
- 形式化验证中的公式简化
- 认知逻辑的理论研究

## 未来工作

1. **性能优化**: 优化大规模公式的处理性能
2. **功能扩展**: 支持更复杂的认知操作
3. **集成测试**: 与现有系统的集成测试
4. **文档完善**: 更详细的使用文档和API文档
